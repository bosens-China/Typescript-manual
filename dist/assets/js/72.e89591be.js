(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{336:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),a("p",[t._v("一般来讲，你"),a("em",[t._v("组织")]),t._v("声明文件的方式取决于库是如何被使用的。\n在 JavaScript 中一个库有很多使用方式，这就需要你书写声明文件去匹配它们。\n这篇指南涵盖了如何识别常见库的模式，和怎样书写符合相应模式的声明文件。")]),t._v(" "),a("p",[t._v("针对每种主要的库的组织模式，在"),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/Templates.html"}},[t._v("模版")]),t._v("一节都有对应的文件。\n你可以利用它们帮助你快速上手。")],1),t._v(" "),a("h1",{attrs:{id:"识别库的类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#识别库的类型"}},[t._v("#")]),t._v(" 识别库的类型")]),t._v(" "),a("p",[t._v("首先，我们先看一下 TypeScript 声明文件能够表示的库的类型。\n这里会简单展示每种类型的库的使用方式，如何去书写，还有一些真实案例。")]),t._v(" "),a("p",[t._v("识别库的类型是书写声明文件的第一步。\n我们将会给出一些提示，关于怎样通过库的"),a("em",[t._v("使用方法")]),t._v("及其"),a("em",[t._v("源码")]),t._v("来识别库的类型。\n根据库的文档及组织结构不同，这两种方式可能一个会比另外的那个简单一些。\n我们推荐你使用任意你喜欢的方式。")]),t._v(" "),a("h2",{attrs:{id:"全局库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局库"}},[t._v("#")]),t._v(" 全局库")]),t._v(" "),a("p",[a("em",[t._v("全局")]),t._v("库是指能在全局命名空间下访问的（例如：不需要使用任何形式的 "),a("code",[t._v("import")]),t._v(" ）。\n许多库都是简单的暴露出一个或多个全局变量。\n比如，如果你使用过"),a("a",{attrs:{href:"https://jquery.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v(" jQuery"),a("OutboundLink")],1),t._v("， "),a("code",[t._v("$")]),t._v("  变量可以被够简单的引用：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("你经常会在全局库的指南文档上看到如何在 HTML 里用脚本标签引用库：")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://a.great.cdn.for/someLib.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("目前，大多数流行的全局访问型库实际上都以 UMD 库的形式进行书写（见后文）。\nUMD 库的文档很难与全局库文档两者之间难以区分。\n在书写全局声明文件前，一定要确认一下库是否真的不是 UMD。")]),t._v(" "),a("h3",{attrs:{id:"从代码上识别全局库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从代码上识别全局库"}},[t._v("#")]),t._v(" 从代码上识别全局库")]),t._v(" "),a("p",[t._v("全局库的代码通常都十分简单。\n一个全局的 “Hello, world” 库可能是这样的：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createGreeting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("s")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("或这样：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("createGreeting")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("s")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("当你查看全局库的源代码时，你通常会看到：")]),t._v(" "),a("ul",[a("li",[t._v("顶级的 "),a("code",[t._v("var")]),t._v("  语句或 "),a("code",[t._v("function")]),t._v("  声明")]),t._v(" "),a("li",[t._v("一个或多个赋值语句到 "),a("code",[t._v("window.someName")])]),t._v(" "),a("li",[t._v("假设 DOM 原始值像 "),a("code",[t._v("document")]),t._v("  或 "),a("code",[t._v("window")]),t._v("  是存在的")])]),t._v(" "),a("p",[t._v("你"),a("em",[t._v("不会")]),t._v("看到：")]),t._v(" "),a("ul",[a("li",[t._v("检查是否使用或如何使用模块加载器，比如 "),a("code",[t._v("require")]),t._v("  或 "),a("code",[t._v("define")])]),t._v(" "),a("li",[t._v("CommonJS/Node.js 风格的导入如 "),a("code",[t._v('var fs = require("fs");')])]),t._v(" "),a("li",[a("code",[t._v("define(...)")]),t._v("  调用")]),t._v(" "),a("li",[t._v("文档里说明了如何去 "),a("code",[t._v("require")]),t._v("  或导入这个库")])]),t._v(" "),a("h3",{attrs:{id:"全局库的例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局库的例子"}},[t._v("#")]),t._v(" 全局库的例子")]),t._v(" "),a("p",[t._v("由于把一个全局库转变成 UMD 库是非常容易的，所以很少流行的库还再使用全局的风格。\n然而，小型的且需要 DOM（或"),a("em",[t._v("没有")]),t._v("依赖）的库可能还是全局类型的。")]),t._v(" "),a("h3",{attrs:{id:"全局库模版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局库模版"}},[t._v("#")]),t._v(" 全局库模版")]),t._v(" "),a("p",[t._v("模版文件"),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/templates/global.d.ts.html"}},[a("code",[t._v("global.d.ts")])]),t._v(" 定义了 "),a("code",[t._v("myLib")]),t._v("  库作为例子。\n一定要阅读"),a("a",{attrs:{href:"#preventing-name-conflicts"}},[t._v(' "防止命名冲突" 补充说明')]),t._v("。")],1),t._v(" "),a("h2",{attrs:{id:"模块化库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块化库"}},[t._v("#")]),t._v(" 模块化库")]),t._v(" "),a("p",[t._v("一些库只能工作在模块加载器的环境下。\n比如， "),a("code",[t._v("express")]),t._v("  只能在 Node.js 里工作，所以必须使用 CommonJS 的 "),a("code",[t._v("require")]),t._v("  函数加载。")]),t._v(" "),a("p",[t._v("ECMAScript 2015（也就是 ES2015，ECMAScript 6 或 ES6），CommonJS 和 RequireJS 具有相似的"),a("em",[t._v("导入")]),t._v("一个"),a("em",[t._v("模块")]),t._v("的表示方法。\n例如，对于 JavaScript CommonJS （Node.js），有下面的代码")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("对于 TypeScript 或 ES6， "),a("code",[t._v("import")]),t._v("  关键字也具有相同的作用：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("你通常会在模块化库的文档里看到如下说明：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" someLib "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'someLib'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("或")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("define")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'someLib'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("someLib")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("与全局模块一样，你也可能会在 UMD 模块的文档里看到这些例子，因此要仔细查看源码和文档。")]),t._v(" "),a("h3",{attrs:{id:"从代码上识别模块化库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从代码上识别模块化库"}},[t._v("#")]),t._v(" 从代码上识别模块化库")]),t._v(" "),a("p",[t._v("模块库至少会包含下列具有代表性的条目之一：")]),t._v(" "),a("ul",[a("li",[t._v("无条件的调用 "),a("code",[t._v("require")]),t._v("  或 "),a("code",[t._v("define")])]),t._v(" "),a("li",[t._v("像 "),a("code",[t._v("import * as a from 'b';")]),t._v("  or  "),a("code",[t._v("export c;")]),t._v("  这样的声明")]),t._v(" "),a("li",[t._v("赋值给 "),a("code",[t._v("exports")]),t._v("  或 "),a("code",[t._v("module.exports")])])]),t._v(" "),a("p",[t._v("它们极少包含：")]),t._v(" "),a("ul",[a("li",[t._v("对 "),a("code",[t._v("window")]),t._v("  或 "),a("code",[t._v("global")]),t._v("  的赋值")])]),t._v(" "),a("h3",{attrs:{id:"模块化库的例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块化库的例子"}},[t._v("#")]),t._v(" 模块化库的例子")]),t._v(" "),a("p",[t._v("许多流行的 Node.js 库都是这种模块化的，例如"),a("a",{attrs:{href:"http://expressjs.com/",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("express")]),t._v(" "),a("OutboundLink")],1),t._v("，"),a("a",{attrs:{href:"http://gulpjs.com/",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("gulp")]),t._v(" "),a("OutboundLink")],1),t._v(" 和"),a("a",{attrs:{href:"https://github.com/request/request",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("request")]),t._v(" "),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"umd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#umd"}},[t._v("#")]),t._v(" "),a("em",[t._v("UMD")])]),t._v(" "),a("p",[a("em",[t._v("UMD")]),t._v(" 模块是指那些既可以作为模块使用（通过导入）又可以作为全局（在没有模块加载器的环境里）使用的模块。\n许多流行的库，比如"),a("a",{attrs:{href:"http://momentjs.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v(" Moment.js"),a("OutboundLink")],1),t._v("，就是这样的形式。\n比如，在 Node.js 或 RequireJS 里，你可以这样写：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" moment "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"moment"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("moment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("然而在纯净的浏览器环境里你也可以这样写：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("moment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"识别umd库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#识别umd库"}},[t._v("#")]),t._v(" 识别 UMD 库")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/umdjs/umd",target:"_blank",rel:"noopener noreferrer"}},[t._v("UMD 模块"),a("OutboundLink")],1),t._v("会检查是否存在模块加载器环境。\n这是非常形容观察到的模块，它们会像下面这样：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" define "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"function"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" define"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("amd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("define")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"libName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" module "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"object"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"libName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("returnExports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("factory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("libName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),a("p",[t._v("如果你在库的源码里看到了 "),a("code",[t._v("typeof define")]),t._v(" ， "),a("code",[t._v("typeof window")]),t._v(" ，或 "),a("code",[t._v("typeof module")]),t._v("  这样的测试，尤其是在文件的顶端，那么它几乎就是一个 UMD 库。")]),t._v(" "),a("p",[t._v("UMD 库的文档里经常会包含通过 "),a("code",[t._v("require")]),t._v(" “在 Node.js 里使用” 例子，\n和 “在浏览器里使用” 的例子，展示如何使用 "),a("code",[t._v("<script>")]),t._v("  标签去加载脚本。")]),t._v(" "),a("h3",{attrs:{id:"umd库的例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#umd库的例子"}},[t._v("#")]),t._v(" UMD 库的例子")]),t._v(" "),a("p",[t._v("大多数流行的库现在都能够被当成 UMD 包。\n比如"),a("a",{attrs:{href:"https://jquery.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v(" jQuery"),a("OutboundLink")],1),t._v(","),a("a",{attrs:{href:"http://momentjs.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Moment.js"),a("OutboundLink")],1),t._v(","),a("a",{attrs:{href:"https://lodash.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("lodash"),a("OutboundLink")],1),t._v(" 和许多其它的。")]),t._v(" "),a("h3",{attrs:{id:"模版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模版"}},[t._v("#")]),t._v(" 模版")]),t._v(" "),a("p",[t._v("针对模块有三种可用的模块，\n"),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/templates/module.d.ts.html"}},[a("code",[t._v("module.d.ts")])]),t._v(", "),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/templates/module-class.d.ts.html"}},[a("code",[t._v("module-class.d.ts")])]),t._v(" and "),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/templates/module-function.d.ts.html"}},[a("code",[t._v("module-function.d.ts")])]),t._v(".")],1),t._v(" "),a("p",[t._v("使用"),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/templates/module-function.d.ts.html"}},[a("code",[t._v("module-function.d.ts")])]),t._v("，如果模块能够作为函数"),a("em",[t._v("调用")]),t._v("。")],1),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Note: calling 'x' as a function")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("x")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("一定要阅读"),a("a",{attrs:{href:"#the-impact-of-es6-on-module-call-signatures"}},[t._v("补充说明： “ES6 模块调用签名的影响”")])]),t._v(" "),a("p",[t._v("使用"),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/templates/module-class.d.ts.html"}},[a("code",[t._v("module-class.d.ts")])]),t._v(" 如果模块能够使用 "),a("code",[t._v("new")]),t._v("  来"),a("em",[t._v("构造")]),t._v("：")],1),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Note: using 'new' operator on the imported variable")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("x")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("相同的"),a("a",{attrs:{href:"#the-impact-of-es6-on-module-plugins"}},[t._v("补充说明")]),t._v("作用于这些模块。")]),t._v(" "),a("p",[t._v("如果模块不能被调用或构造，使用"),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/templates/module.d.ts.html"}},[a("code",[t._v("module.d.ts")])]),t._v(" 文件。")],1),t._v(" "),a("h2",{attrs:{id:"模块插件或umd插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块插件或umd插件"}},[t._v("#")]),t._v(" "),a("em",[t._v("模块插件")]),t._v("或"),a("em",[t._v(" UMD 插件")])]),t._v(" "),a("p",[t._v("一个"),a("em",[t._v("模块插件")]),t._v("可以改变一个模块的结构（UMD 或模块）。\n例如，在 Moment.js 里， "),a("code",[t._v("moment-range")]),t._v("  添加了新的 "),a("code",[t._v("range")]),t._v("  方法到 "),a("code",[t._v("monent")]),t._v("  对象。")]),t._v(" "),a("p",[t._v("对于声明文件的目标，我们会写相同的代码不论被改变的模块是一个纯粹的模块还是 UMD 模块。")]),t._v(" "),a("h3",{attrs:{id:"模版-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模版-2"}},[t._v("#")]),t._v(" 模版")]),t._v(" "),a("p",[t._v("使用"),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/templates/module-plugin.d.ts.html"}},[a("code",[t._v("module-plugin.d.ts")])]),t._v(" 模版。")],1),t._v(" "),a("h2",{attrs:{id:"全局插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局插件"}},[t._v("#")]),t._v(" "),a("em",[t._v("全局插件")])]),t._v(" "),a("p",[t._v("一个"),a("em",[t._v("全局插件")]),t._v("是全局代码，它们会改变全局对象的结构。\n对于"),a("em",[t._v("全局修改的模块")]),t._v("，在运行时存在冲突的可能。")]),t._v(" "),a("p",[t._v("比如，一些库往 "),a("code",[t._v("Array.prototype")]),t._v("  或 "),a("code",[t._v("String.prototype")]),t._v("  里添加新的方法。")]),t._v(" "),a("h3",{attrs:{id:"识别全局插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#识别全局插件"}},[t._v("#")]),t._v(" 识别全局插件")]),t._v(" "),a("p",[t._v("全局通常很容易地从它们的文档识别出来。")]),t._v(" "),a("p",[t._v("你会看到像下面这样的例子：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello, world"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Creates new methods on built-in types")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startsWithHello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Creates new methods on built-in types")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reverseAndSort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"模版-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模版-3"}},[t._v("#")]),t._v(" 模版")]),t._v(" "),a("p",[t._v("使用"),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/templates/global-plugin.d.ts.html"}},[a("code",[t._v("global-plugin.d.ts")])]),t._v(" 模版。")],1),t._v(" "),a("h2",{attrs:{id:"全局修改的模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局修改的模块"}},[t._v("#")]),t._v(" "),a("em",[t._v("全局修改的模块")])]),t._v(" "),a("p",[t._v("当一个"),a("em",[t._v("全局修改的模块")]),t._v("被导入的时候，它们会改变全局作用域里的值。\n比如，存在一些库它们添加新的成员到 "),a("code",[t._v("String.prototype")]),t._v("  当导入它们的时候。\n这种模式很危险，因为可能造成运行时的冲突，\n但是我们仍然可以为它们书写声明文件。")]),t._v(" "),a("h3",{attrs:{id:"识别全局修改的模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#识别全局修改的模块"}},[t._v("#")]),t._v(" 识别全局修改的模块")]),t._v(" "),a("p",[t._v("全局修改的模块通常可以很容易地从它们的文档识别出来。\n通常来讲，它们与全局插件相似，但是需要 "),a("code",[t._v("require")]),t._v("  调用来激活它们的效果。")]),t._v(" "),a("p",[t._v("你可能会看到像下面这样的文档:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'require' call that doesn't use its return value")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" unused "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"magic-string-time"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* or */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"magic-string-time"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello, world"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Creates new methods on built-in types")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startsWithHello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Creates new methods on built-in types")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reverseAndSort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"模版-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模版-4"}},[t._v("#")]),t._v(" 模版")]),t._v(" "),a("p",[t._v("使用"),a("router-link",{attrs:{to:"/backups/TypeScript-master/doc/handbook/declaration files/templates/global-modifying-module.d.ts.html"}},[a("code",[t._v("global-modifying-module.d.ts")])]),t._v(" 模版。")],1),t._v(" "),a("h1",{attrs:{id:"使用依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用依赖"}},[t._v("#")]),t._v(" "),a("a",{attrs:{name:"consuming-dependencies"}}),t._v("使用依赖")]),t._v(" "),a("p",[t._v("你的代码库可能有好几种类型的依赖。\n这部分会介绍如何把它们导入声明文件。")]),t._v(" "),a("h2",{attrs:{id:"依赖全局库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#依赖全局库"}},[t._v("#")]),t._v(" 依赖全局库")]),t._v(" "),a("p",[t._v("如果你的库依赖于某个全局库，使用 "),a("code",[t._v('/// <reference types="..." />')]),t._v("  指令：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/// <reference types="someLib" />')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getThing")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" someLib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("thing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"依赖模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#依赖模块"}},[t._v("#")]),t._v(" 依赖模块")]),t._v(" "),a("p",[t._v("如果你的库依赖于模块，使用 "),a("code",[t._v("import")]),t._v("  语句：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" moment "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"moment"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getThing")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" moment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"依赖umd库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#依赖umd库"}},[t._v("#")]),t._v(" 依赖 UMD 库")]),t._v(" "),a("h3",{attrs:{id:"从全局库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从全局库"}},[t._v("#")]),t._v(" 从全局库")]),t._v(" "),a("p",[t._v("如果你的全局库依赖于某个 UMD 模块，使用 "),a("code",[t._v("/// <reference types")]),t._v("  指令：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/// <reference types="moment" />')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getThing")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" moment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"从一个模块或umd库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从一个模块或umd库"}},[t._v("#")]),t._v(" 从一个模块或 UMD 库")]),t._v(" "),a("p",[t._v("如果你的模块或 UMD 库依赖于一个 UMD 库，使用 "),a("code",[t._v("import")]),t._v("  语句：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" someLib "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'someLib'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("em",[t._v("不要")]),t._v("使用 "),a("code",[t._v("/// <reference")]),t._v("  指令去声明 UMD 库的依赖！")]),t._v(" "),a("h1",{attrs:{id:"补充说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#补充说明"}},[t._v("#")]),t._v(" 补充说明")]),t._v(" "),a("h2",{attrs:{id:"防止命名冲突"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防止命名冲突"}},[t._v("#")]),t._v(" "),a("a",{attrs:{name:"preventing-name-conflicts"}}),t._v("防止命名冲突")]),t._v(" "),a("p",[t._v("注意，在书写全局声明文件时，允许在全局作用域里定义很多类型。\n我们十分不建义这样做，当一个工程里有许多声明文件时，它会导致无法处理的命名冲突。")]),t._v(" "),a("p",[t._v("一个简单的规则是使用库定义的全局变量名来声明命名空间类型。\n比如，库定义了一个全局的值 "),a("code",[t._v("cats")]),t._v(" ，你可以这样写")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" cats "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KittySettings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("em",[t._v("不要")])]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// at top-level")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CatsKittySettings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这样也保证了库在转换成 UMD 的时候没有任何的破坏式改变，对于声明文件用户来说。")]),t._v(" "),a("h2",{attrs:{id:"es6模块插件的影响"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#es6模块插件的影响"}},[t._v("#")]),t._v(" "),a("a",{attrs:{name:"the-impact-of-es6-on-module-plugins"}}),t._v("ES6 模块插件的影响")]),t._v(" "),a("p",[t._v("一些插件添加或修改已存在的顶层模块的导出部分。\n当然这在 CommonJS 和其它加载器里是允许的，ES 模块被当作是不可改变的因此这种模式就不可行了。\n因为 TypeScript 是能不预知加载器类型的，所以没没在编译时保证，但是开发者如果要转到 ES6 模块加载器上应该注意这一点。")]),t._v(" "),a("h2",{attrs:{id:"es6模块调用签名的影响"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#es6模块调用签名的影响"}},[t._v("#")]),t._v(" "),a("a",{attrs:{name:"the-impact-of-es6-on-module-call-signatures"}}),t._v("ES6 模块调用签名的影响")]),t._v(" "),a("p",[t._v("很多流行库，比如 Express，暴露出自己作为可以调用的函数。\n比如，典型的 Express 使用方法如下：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" exp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"express"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("在 ES6 模块加载器里，顶层的对象（这里以 "),a("code",[t._v("exp")]),t._v("  导入）只能具有属性；\n顶层的模块对象"),a("em",[t._v("永远不能")]),t._v("被调用。\n十分常见的解决方法是定义一个 "),a("code",[t._v("default")]),t._v("  导出到一个可调用的 / 可构造的对象；\n一会模块加载器助手工具能够自己探测到这种情况并且使用 "),a("code",[t._v("default")]),t._v("  导出来替换顶层对象。")]),t._v(" "),a("h2",{attrs:{id:"代码库文件结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代码库文件结构"}},[t._v("#")]),t._v(" 代码库文件结构")]),t._v(" "),a("p",[t._v("声明文件的结构应该与代码文件结构保持一致。\n一个库可能由多个模块构成，比如")]),t._v(" "),a("div",{staticClass:"language-txt extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("myLib\n  +---- index.js\n  +---- foo.js\n  +---- bar\n         +---- index.js\n         +---- baz.js\n")])])]),a("p",[t._v("它们可以被这样导入")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myLib"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myLib/foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" c "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myLib/bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" d "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myLib/bar/baz"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("声明应该这样写")]),t._v(" "),a("div",{staticClass:"language-txt extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("@types/myLib\n  +---- index.d.ts\n  +---- foo.d.ts\n  +---- bar\n         +---- index.d.ts\n         +---- baz.d.ts\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);